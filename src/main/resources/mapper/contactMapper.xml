<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="app.codingGround.api.account.mapper.ContactMapper">
    <select id="getContactList" resultType="ContactListDto">
        SELECT
            c.CONTACT_NUM,
            c.USER_NUM,
            c.CONTACT_TITLE,
            c.CONTACT_CONTENT,
            DATE_FORMAT(c.CONTACT_TIME, '%Y/%m/%d %H:%i') AS CONTACT_TIME,
            u.USER_NICKNAME,
            CASE
                WHEN c.CONTACT_ANSWER IS NULL THEN 0
                ELSE 1
                END AS ANSWER_STATUS
        FROM
            TB_CONTACT c
                INNER JOIN
            TB_USER u
            ON
                c.USER_NUM = u.USER_NUM
        WHERE
            c.USE_STATUS = 1
          AND
            c.CONTACT_TITLE LIKE CONCAT('%', #{saerchInput}, '%')
        ORDER BY
            ANSWER_STATUS ASC,
            c.CONTACT_NUM DESC;
    </select>

    <select id="getContactDetail" resultType="ContactDetailDto">
        SELECT
            c.CONTACT_NUM,
            c.CONTACT_TITLE,
            c.CONTACT_CONTENT,
            DATE_FORMAT(c.CONTACT_TIME, '%Y/%m/%d %H:%i') AS CONTACT_TIME,
            c.CONTACT_ANSWER,
            c.USE_STATUS,
            u.USER_NICKNAME,
            u.USER_PROFILE_IMG
        FROM
            TB_CONTACT c
                INNER JOIN
            TB_USER u ON c.USER_NUM = u.USER_NUM
        WHERE
            c.CONTACT_NUM = #{contactNum}
    </select>
</mapper>

